# レベル2: 実用チュートリアル（60分コース）

## 🎯 目標
このチュートリアルでは、より実践的なLoRAファインチューニングを体験し、技術的な知識を組み合わせたモデルの学習を行います。

**所要時間**: 約60分  
**前提知識**: レベル1の基本チュートリアル完了  
**学習内容**: 大規模データセット、パラメータ調整、結果分析、モデル比較

---

## 📋 事前準備

### ✅ 1. レベル1の完了確認
レベル1の基本チュートリアルを完了し、以下を理解していることを確認してください：
- データセットアップロード方法
- 基本的なLoRAパラメータ
- 訓練ジョブの作成と監視

### ✅ 2. システム状態確認
```bash
# すべてのサービスが起動していることを確認
docker-compose ps

# 利用可能なモデルを確認
docker exec llmlora-ollama ollama list
```

### ✅ 3. より大きなモデルの準備
今回は7Bパラメータのモデルでより本格的な学習を行います：
```bash
# 必要に応じてモデルをダウンロード
docker exec llmlora-ollama ollama pull llama2:7b
```

---

## 🚀 ステップ1: より大きなデータセットでの学習

### 1.1 実用データセットをダウンロード
このレベルでは20例の技術知識Q&Aデータセットを使用します。

プリセットデータセットが既に準備されています：
- **ファイル**: `tutorial/datasets/level2_practical_knowledge.json`
- **内容**: プログラミング、技術、IT関連の質問応答20例
- **特徴**: より複雑で実用的な知識

### 1.2 データセットアップロード
1. **データセット**タブに移動
2. **「データセットをアップロード」**をクリック
3. アップロードフォームで以下を入力：
   - **ファイル**: `tutorial/datasets/level2_practical_knowledge.json`
   - **名前**: "実用技術知識Q&A"
   - **説明**: "プログラミングとIT技術に関する実用的な質問応答データ"
   - **タイプ**: "指示"
4. **「アップロード」**をクリック

### 1.3 データセットの確認
- **タイプ**: 指示
- **サイズ**: 20 例
- データの複雑性がレベル1より高いことを確認

---

## ⚙️ ステップ2: パラメータ調整の実践

### 2.1 新しい訓練ジョブを作成
1. **訓練**タブ → **「新しい訓練ジョブ」**
2. 基本情報を入力：
   - **ジョブ名**: "実用技術知識モデル"
   - **ベースモデル**: "llama2:7b"
   - **訓練データセット**: "実用技術知識Q&A (20 例)"

### 2.2 LoRA設定の最適化
今回は**バランス型**設定を使用します：

1. **「クイックプリセット」** → **「バランス型 (r=8)」**をクリック
2. 設定確認：
   - **ランク**: 8
   - **アルファ**: 16
   - **ドロップアウト**: 0.05
   - **対象モジュール**: q_proj, v_proj, k_proj, o_proj

**💡 なぜバランス型？**
- より多くのパラメータ（r=8）で複雑なパターンを学習
- 4つの注意機構モジュールで表現力向上
- 20例のデータセットに適したパラメータ設定

### 2.3 訓練設定の詳細調整
**標準**プリセットを基本に、手動で調整します：

1. **「クイックプリセット」** → **「標準」**をクリック
2. 以下の値を手動で調整：
   - **学習率**: 0.0001 に変更（やや高め）
   - **エポック数**: 3 に変更（複数エポックで学習）
   - **バッチサイズ**: 4 に変更（効率的な学習）
   - **最大長**: 1024 に変更（長いテキストに対応）

**🎯 調整の理由**
- **学習率**: 大きなデータセットでより積極的な学習
- **エポック数**: 複数回の学習で知識を定着
- **バッチサイズ**: メモリとの兼ね合いで最適化
- **最大長**: 技術説明文の長さに対応

---

## 🏃 ステップ3: 訓練の実行と詳細監視

### 3.1 訓練開始
1. 設定を最終確認
2. **「訓練を開始」**をクリック
3. **「詳細を表示」**で詳細画面に移動

### 3.2 詳細な進捗監視
**期待される動作**：
- **エポック1**: 初期の急激な損失減少
- **エポック2**: 徐々に安定化
- **エポック3**: 細かい調整と収束

**⏱️ 予想実行時間**: 約15-25分（MacBook Air M4）

### 3.3 リアルタイム分析
詳細画面で以下を監視：

**損失値の変化**：
- 開始時: ~2.5-3.0
- 中間: ~1.5-2.0
- 終了時: ~0.8-1.2（目標）

**学習の健全性確認**：
- 損失が段階的に減少しているか
- 急激な振動がないか
- オーバーフィッティングの兆候はないか

---

## 📊 ステップ4: 結果分析と比較

### 4.1 訓練結果の詳細分析
完了後、以下を確認：

**最終メトリクス**：
- **最終損失**: 1.0以下が理想的
- **訓練時間**: 記録として保存
- **メモリ使用量**: パフォーマンス評価

**学習曲線の解釈**：
- 損失の減少パターン
- エポック間の改善度
- 収束の安定性

### 4.2 レベル1との比較
| 項目 | レベル1 | レベル2 | 改善点 |
|------|---------|---------|--------|
| データ例数 | 5例 | 20例 | 4倍の学習データ |
| LoRAランク | 4 | 8 | 2倍の表現力 |
| エポック数 | 1 | 3 | より深い学習 |
| 最大長 | 512 | 1024 | 長文対応 |
| 予想損失 | ~1.5 | ~1.0 | より高精度 |

### 4.3 品質評価
学習したモデルの品質を評価：

**期待される改善点**：
- より正確で詳細な回答
- 技術用語の適切な使用
- 文脈に沿った説明

---

## 🔬 ステップ5: パラメータ実験（オプション）

### 5.1 異なる設定での実験
時間に余裕がある場合、以下の実験を行います：

**実験1: 高パフォーマンス設定**
- LoRAランク: 16
- 学習率: 0.00005（低め）
- エポック数: 5

**実験2: 高速学習設定**
- LoRAランク: 4
- 学習率: 0.0002（高め）
- エポック数: 2

### 5.2 結果の比較
複数の実験結果を比較して、最適な設定を見つけます。

---

## 🎉 完了！次のステップ

### ✅ 学習内容の確認
このチュートリアルで学んだこと：
- [x] より大きなデータセットでの実践的学習
- [x] LoRAパラメータの詳細調整
- [x] 複数エポックでの学習監視
- [x] 学習曲線の分析と解釈
- [x] 異なる設定での比較実験

### 🎯 習得したスキル
- **パラメータ調整**: データサイズに応じた最適化
- **学習監視**: リアルタイムでの品質評価
- **結果分析**: 定量的・定性的な評価手法
- **実験計画**: 体系的なアプローチ

### 🚀 次のレベルへ
実用的なスキルを身につけました！次は：
- **レベル3（高度なチュートリアル）**: 専門分野でのカスタマイズ
- **独自データセット**: 自分のデータでの実践
- **プロダクション設定**: より大規模な運用

---

## 🚨 高度なトラブルシューティング

### Q1: 損失が下がらない
**症状**: 3エポック経っても損失が2.0以上  
**対処法**:
- 学習率を0.0002に上げる
- バッチサイズを2に下げる
- データの品質を再確認

### Q2: オーバーフィッティングの兆候
**症状**: 損失が急激に下がりすぎる（0.3以下）  
**対処法**:
- ドロップアウトを0.1に上げる
- エポック数を2に減らす
- 正則化パラメータの調整

### Q3: メモリ不足
**症状**: 途中でOut of Memoryエラー  
**対処法**:
- バッチサイズを2または1に減らす
- 最大長を512に戻す
- LoRAランクを4に減らす

### Q4: 学習が不安定
**症状**: 損失値が大きく振動する  
**対処法**:
- 学習率を0.00005に下げる
- より小さなランク（r=4）を試す
- データセットの品質を再確認

---

## 📚 発展的な学習

### パラメータ最適化の理論
- [LoRA最適化ガイド](../concepts/lora_optimization.md)
- [学習率スケジューリング](../concepts/learning_rate_scheduling.md)

### 実践的な応用
- [カスタムデータセット作成](../concepts/custom_dataset_creation.md)
- [モデル評価手法](../concepts/model_evaluation.md)

### 次のステップ
- [高度なファインチューニング戦略](../concepts/advanced_strategies.md)
- [プロダクション運用ガイド](../concepts/production_deployment.md)

---

**🎊 おめでとうございます！**  
実用的なLoRAファインチューニングをマスターしました。次は専門分野での高度なカスタマイズに挑戦しましょう！